let canvas,ctx,width,height,currentState,okbtn,fgpos=0,frames=0,score=0,best=0,states={Splash:0,Game:1,Score:2},bird={x:60,y:0,frame:0,velocity:0,animation:[0,1,2,1],rotation:0,gravity:.25,_jump:4.6,radius:12,jump:function(){this.velocity=-this._jump},update:function(){let t=splashState()?10:5;this.frame+=frames%t==0?1:0,this.frame%=this.animation.length,splashState()?(this.y=height-280+5*Math.cos(frames/10),this.rotation=0):(this.velocity+=this.gravity,this.y+=this.velocity,this.y>=height-s_fg.height-10&&(this.y=height-s_fg.height-10,gameState()&&(currentState=states.Score),this.velocity=this._jump),this.velocity>=this._jump?(this.frame=1,this.rotation=Math.min(Math.PI/2,this.rotation+.3)):this.rotation=-.3)},draw:function(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation);let e=this.animation[this.frame];s_bird[e].draw(t,-s_bird[e].width/2,-s_bird[e].height/2),t.restore()}},pipes={_pipes:[],reset:function(){this._pipes=[]},update:function(){if(frames%100==0){let t=height-(s_pipeSouth.height+s_fg.height+120+200*Math.random());this._pipes.push({x:500,y:t,width:s_pipeSouth.width,height:s_pipeSouth.height})}for(let t=0,e=this._pipes.length;t<e;t++){let i=this._pipes[t];if(0===t){score+=i.x===bird.x?1:0;let t=Math.min(Math.max(bird.x,i.x),i.x+i.width),e=Math.min(Math.max(bird.y,i.y),i.y+i.height),s=Math.min(Math.max(bird.y,i.y+i.height+80),i.y+2*i.height+80),h=bird.x-t,a=bird.y-e,r=bird.y-s,n=h*h+a*a,o=h*h+r*r,d=bird.radius*bird.radius;(d>n||d>o)&&(currentState=states.Score)}i.x-=2,i.x<-i.width&&(this._pipes.splice(t,1),t--,e--)}},draw:function(t){for(let e=0,i=this._pipes.length;e<i;e++){let i=this._pipes[e];s_pipeSouth.draw(t,i.x,i.y),s_pipeNorth.draw(t,i.x,i.y+80+i.height)}}};function onPress(t){switch(currentState){case states.Splash:currentState=states.Game,bird.jump();break;case states.Game:bird.jump();break;case states.Score:let e=t.offsetX,i=t.offsetY;null!=e&&null!=i||(e=t.touches[0].clientX,i=t.touches[0].clientY),okbtn.x<e&&e<okbtn.x+okbtn.width&&okbtn.y<i&&i<okbtn.y+okbtn.height&&(pipes.reset(),currentState=states.Splash,score=0)}}function main(){canvas=document.createElement("canvas"),width=window.innerWidth,height=window.innerHeight;let t="touchstart";width>=500&&(width=320,height=480,canvas.style.border="1px solid #000",t="mousedown"),document.addEventListener(t,onPress),canvas.width=width,canvas.height=height,ctx=canvas.getContext("2d"),currentState=states.Splash,document.body.appendChild(canvas);let e=new Image;e.src="res/sheet.png",e.onload=function(){initSprites(this),ctx.fillStyle=s_bg.color,okbtn={x:(width-s_buttons.Ok.width)/2,y:height-200,width:s_buttons.Ok.width,height:s_buttons.Ok.height},run()}}function run(){let t=function(){update(),render(),window.requestAnimationFrame(t,canvas)};window.requestAnimationFrame(t,canvas)}function update(){frames++,scoreState()?best=Math.max(best,score):fgpos=(fgpos-2)%14,gameState()&&pipes.update(),bird.update()}function render(){ctx.fillRect(0,0,width,height),s_bg.draw(ctx,0,height-s_bg.height),s_bg.draw(ctx,s_bg.width,height-s_bg.height),pipes.draw(ctx),bird.draw(ctx),s_fg.draw(ctx,fgpos,height-s_fg.height),s_fg.draw(ctx,fgpos+s_fg.width,height-s_fg.height);let t=width/2;splashState()&&(s_splash.draw(ctx,t-s_splash.width/2,height-300),s_text.GetReady.draw(ctx,t-s_text.GetReady.width/2,height-380)),scoreState()?(s_text.GameOver.draw(ctx,t-s_text.GameOver.width/2,height-400),s_score.draw(ctx,t-s_score.width/2,height-340),s_buttons.Ok.draw(ctx,okbtn.x,okbtn.y),s_numberS.draw(ctx,t-47,height-304,score,null,10),s_numberS.draw(ctx,t-47,height-262,best,null,10)):s_numberB.draw(ctx,null,20,score,t)}main();